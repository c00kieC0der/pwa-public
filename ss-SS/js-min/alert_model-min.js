var _Alert={};!function(){var e=document.createEvent("Event");e.initEvent("builder-alert",!0,!0);var t=document.createEvent("Event");t.initEvent("get-alert-completed",!0,!0),_Alert.getAlertData=function(){if(_User.activeLocation){var t=_User.activeLocation,l=t.locId?t.locId+":"+t.locType+":"+t.cntryCd:"";lang=_User.lang.replace("-","_"),r(l,lang,a),o(l,lang,a),document.getElementById("event-anchor").addEventListener("get-alert-completed",function(){var t=(_User.activeLocation,n.bulletin.data),a=n.pollen.data,r=u(t,a,l),o=r.length,i=r.shift();_Alert={bulletins:r,timeZone:"",priority:i,hasAlerts:null!=i,hasMultipleAlerts:r.length>0,alertCount:o},document.getElementById("event-anchor").dispatchEvent(e)})}};var n={bulletin:{isCompleted:!1,data:null},pollen:{isCompleted:!1,data:null}},l={POLLEN_DESCRIPTION:helper.pdTranslate("Local Pollen Alert"),POLLEN:"pollen",TREE:"tree",GRASS:"grass",WEED:"weed",POLLEN_SEVERITY:3,POLLEN_ALERT_TRIGGER_VALUE:3},a=function(){n.bulletin.isCompleted&&n.pollen.isCompleted&&document.getElementById("event-anchor").dispatchEvent(t)},r=function(e,t,l){var a="https://dsx.weather.com/wxd/v2/BERecord/"+t+"/"+e+"?format=json&apiKey=c1ea9f47f6a88b9acb43aba7faf389d4";AjaxRequest.get({url:a,generateUniqueUrl:!1,onSuccess:function(e){n.bulletin.isCompleted=!0,n.bulletin.data=JSON.parse(e.responseText),l instanceof Function&&l()},onError:function(e){n.bulletin.isCompleted=!0,n.bulletin.data=[],l instanceof Function&&l()}})},o=function(e,t,l){var a="https://dsx.weather.com/wxd/v2/Pollen/"+t+"/"+e+"?format=json&apiKey=c1ea9f47f6a88b9acb43aba7faf389d4";AjaxRequest.get({url:a,generateUniqueUrl:!1,onSuccess:function(e){n.pollen.isCompleted=!0,n.pollen.data=JSON.parse(e.responseText),l instanceof Function&&l()},onError:function(e){n.pollen.isCompleted=!0,n.pollen.data=[],l instanceof Function&&l()}})},i=function(e,t,n){var l=0;return e&&(l=Math.max(l,e.idxPrt1)),t&&(l=Math.max(l,t.idxPrt1)),n&&(l=Math.max(l,n.idxPrt1)),l},c=function(e){if(!e)return null;var t=(e.pollenAlerts,e&&e[l.TREE]?e[l.TREE].shift():null),n=e&&e[l.GRASS]?e[l.GRASS].shift():null,a=e&&e[l.WEED]?e[l.WEED].shift():null,r=i(t,n,a);return r>=l.POLLEN_ALERT_TRIGGER_VALUE?{description:l.POLLEN_DESCRIPTION,severity:l.POLLEN_SEVERITY,url:"",type:l.POLLEN,fromStr:l.POLLEN}:null},s=function(e,t){var n="";return _User.lang&&moment.locale(_User.lang),n=moment(e).format("h:mm")+" "+t+" "+moment(e).format("ddd MMM d")},d=function(e,t,n){var l=e.BEHdr&&e.BEHdr.bEvent,a=e.BEHdr,r=e.BEHdr&&e.BEHdr.bLocations,o=e.BEData,i=l?l.ePhenom:"",c=r?r.bLocCd:"",d=l?l.eETN:"",u=l?l.eOfficeId:"",E=l?l.eSgnfcnc:"",f=l?l._eStTmLocal:"",m=l?l._eEndTmLocal:l,p=r?r.bTzAbbrv:"",v=o?o.bIssueTmISOLocal:"",L={};_Lang["h:mma z, EEE MMM d"];n="/weather/alerts/localalerts/l/";for(var h,_=/00/gi,S=[],b=[];h=_.exec(f);)S.push(h.index);for(;h=_.exec(m);)b.push(h.index);if(l.eFld){var g=l.eFld&&l.eFld._eFldSeq,T=l.eFld&&l.eFld.eNWSLICd__eNWSLI;T?L.description=g?l.eDesc+" ("+T+") #"+g:l.eDesc+" ("+T+")":L.description=g?l.eDesc+" #"+g:l.eDesc}else L.description=a&&a._multiPostfix?l.eDesc+" #"+a._multiPostfix:l.eDesc;return L.severity=l.eSvrty,L.validStartTime=s(f,p),L.validEndTime=s(m,p),L.validIssTime=s(v,p),L.url=[n,t||"","?phenomena=",i,"&significance=",E,"&areaid=",c,"&office=",u,"&etn=",d].join(""),L.type="bulletin",L.fromStr=i+"-"+E,L},u=function(e,t,n){var l=[],a=c(t);for(var r in e){var o=d(e[r],n);l.push(o)}return a&&l.push(a),l}}();